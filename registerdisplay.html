<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Register Arrivals Display</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<style>
 body { font-family: sans-serif; margin: 2rem; }
 label { display: block; margin-top: 1rem; }
 input { font-size: 1rem; padding: 0.3rem; }
 button { margin-top: 1rem; padding: 0.5rem 1rem; }
 #status { margin-top: 1rem; }
</style>
</head>
<body>
<h1>Register Arrivals Display</h1>
<p>Enter the device ID shown on the display, a friendly name, and its desired stop ID.</p>
<label>Device ID: <input id="device-id"/></label>
<label>Friendly Name: <input id="friendly-name"/></label>
<label>Stop ID: <input id="stop-id"/></label>
<button onclick="registerDisplay()">Register</button>
<div id="status"></div>

<h2>Registered Devices</h2>
<table id="devices">
  <thead><tr><th>ID</th><th>Friendly Name</th><th>Stop ID</th><th></th></tr></thead>
  <tbody></tbody>
</table>

<script>
async function registerDisplay(){
  const id=document.getElementById('device-id').value.trim();
  const stop=document.getElementById('stop-id').value.trim();
  const fname=document.getElementById('friendly-name').value.trim();
  const status=document.getElementById('status');
  status.textContent='';
  if(!id||!stop){ status.textContent='Device ID and Stop ID required.'; return; }
  try{
    await axios.post('/device-stop',{id,stopID:stop,friendlyName:fname});
    status.textContent='Saved!';
    loadRegistrations();
  }catch(e){
    status.textContent='Error saving.';
    console.error(e);
  }
}

async function loadRegistrations(){
  try{
    const r=await axios.get('/device-stop/list');
    const tbody=document.querySelector('#devices tbody');
    tbody.innerHTML='';
    for(const d of r.data.devices){
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${d.id}</td><td>${d.friendlyName||''}</td><td>${d.stopID}</td>`+
                  `<td><button onclick="deleteReg('${d.id}')">Delete</button></td>`;
      tbody.appendChild(tr);
    }
  }catch(e){
    console.error(e);
  }
}

async function deleteReg(id){
  if(!confirm('Delete registration for '+id+'?')) return;
  try{
    await axios.delete('/device-stop/'+id);
    loadRegistrations();
  }catch(e){
    console.error(e);
  }
}

loadRegistrations();
</script>
</body>
</html>
