<!doctype html>
<meta charset="utf-8">
<title>External API Calls - Headway Guard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
@font-face{font-family:'FGDC';src:url('FGDC.ttf') format('truetype')}
body{font:16px 'FGDC',system-ui;background:#0b0e11;color:#e8eef5;margin:0;padding:20px;}
ul{list-style:none;padding:0;margin:0;}
li{padding:4px 0;border-bottom:1px solid #2a3442;word-break:break-all;}
.credit{position:fixed;bottom:8px;right:8px;font-size:12px;color:#9fb0c9}
</style>
<h1>External API Calls</h1>
<ul id="log"></ul>
<div class="credit">proof of concept created by pat cox â€¢ phc6j@virginia.edu</div>
<script>
const log=document.getElementById('log');
function toEasternDate(ts){
  const d=new Date(ts);
  const y=d.getUTCFullYear();
  const m1=new Date(Date.UTC(y,2,1));
  const mSun=(7-m1.getUTCDay())%7;
  const dstStart=Date.UTC(y,2,8+mSun,7,0,0);
  const n1=new Date(Date.UTC(y,10,1));
  const nSun=(7-n1.getUTCDay())%7;
  const dstEnd=Date.UTC(y,10,1+nSun,6,0,0);
  const off=(ts>=dstStart && ts<dstEnd)?-4:-5;
  return new Date(ts+off*3600*1000);
}
function formatTime(ts){
  return toEasternDate(ts).toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',second:'2-digit',hour12:true});
}
function add(item){
  const li=document.createElement('li');
  const t=formatTime(item.ts);
  li.textContent=`[${t}] ${item.method} ${item.status} ${item.url}`;
  log.prepend(li);
  while(log.children.length>50) log.removeChild(log.lastChild);
}
const es=new EventSource('/v1/stream/api_calls');
es.onmessage=ev=>{ try{ add(JSON.parse(ev.data)); }catch(_){}};
</script>
